<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-cli 3.x 升级之路 | 前端周刊</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="vue-cli 升级之路">
    <meta name="keywords" content="vue,vue-cli">
    
    <link rel="preload" href="/blog/assets/css/0.styles.bc4e2984.css" as="style"><link rel="preload" href="/blog/assets/js/app.d3fa5209.js" as="script"><link rel="preload" href="/blog/assets/js/6.d4095322.js" as="script"><link rel="preload" href="/blog/assets/js/4.64cbf7a8.js" as="script"><link rel="preload" href="/blog/assets/js/28.a5fc788a.js" as="script"><link rel="preload" href="/blog/assets/js/10.ce23e8e8.js" as="script"><link rel="preload" href="/blog/assets/js/11.7cde289b.js" as="script"><link rel="preload" href="/blog/assets/js/30.967a757e.js" as="script"><link rel="preload" href="/blog/assets/js/25.3294d02e.js" as="script"><link rel="preload" href="/blog/assets/js/13.4b26077c.js" as="script"><link rel="preload" href="/blog/assets/js/21.65ff6ff5.js" as="script"><link rel="preload" href="/blog/assets/js/31.6775aed3.js" as="script"><link rel="preload" href="/blog/assets/js/23.c6a37407.js" as="script"><link rel="preload" href="/blog/assets/js/15.b4502122.js" as="script"><link rel="preload" href="/blog/assets/js/5.865b38fd.js" as="script"><link rel="preload" href="/blog/assets/js/49.53cd3ec8.js" as="script"><link rel="preload" href="/blog/assets/js/24.193852d3.js" as="script"><link rel="prefetch" href="/blog/assets/js/1.d622105c.js"><link rel="prefetch" href="/blog/assets/js/12.6ca6e9f4.js"><link rel="prefetch" href="/blog/assets/js/14.10c8486f.js"><link rel="prefetch" href="/blog/assets/js/16.3866ee9b.js"><link rel="prefetch" href="/blog/assets/js/17.bbe78093.js"><link rel="prefetch" href="/blog/assets/js/18.9907e1f2.js"><link rel="prefetch" href="/blog/assets/js/19.783d5ba6.js"><link rel="prefetch" href="/blog/assets/js/20.3c937b8a.js"><link rel="prefetch" href="/blog/assets/js/22.50ce623e.js"><link rel="prefetch" href="/blog/assets/js/26.eddcc531.js"><link rel="prefetch" href="/blog/assets/js/27.3b8e77fb.js"><link rel="prefetch" href="/blog/assets/js/29.da8cd36f.js"><link rel="prefetch" href="/blog/assets/js/32.9bb40d9c.js"><link rel="prefetch" href="/blog/assets/js/33.1036ba5f.js"><link rel="prefetch" href="/blog/assets/js/34.5612442f.js"><link rel="prefetch" href="/blog/assets/js/35.cc055681.js"><link rel="prefetch" href="/blog/assets/js/36.cabad0ff.js"><link rel="prefetch" href="/blog/assets/js/37.c4424565.js"><link rel="prefetch" href="/blog/assets/js/38.c8fa029c.js"><link rel="prefetch" href="/blog/assets/js/39.19fc3d4a.js"><link rel="prefetch" href="/blog/assets/js/40.f021c568.js"><link rel="prefetch" href="/blog/assets/js/41.793f7f4e.js"><link rel="prefetch" href="/blog/assets/js/42.6f27a5bc.js"><link rel="prefetch" href="/blog/assets/js/43.e8c112b8.js"><link rel="prefetch" href="/blog/assets/js/44.bd1a3840.js"><link rel="prefetch" href="/blog/assets/js/45.a764f837.js"><link rel="prefetch" href="/blog/assets/js/46.9fbc0d8e.js"><link rel="prefetch" href="/blog/assets/js/47.96a9c9e7.js"><link rel="prefetch" href="/blog/assets/js/48.58fd26b9.js"><link rel="prefetch" href="/blog/assets/js/50.240d63b7.js"><link rel="prefetch" href="/blog/assets/js/51.e5b84ed7.js"><link rel="prefetch" href="/blog/assets/js/52.055263b3.js"><link rel="prefetch" href="/blog/assets/js/53.03cc0e10.js"><link rel="prefetch" href="/blog/assets/js/54.bf34bb71.js"><link rel="prefetch" href="/blog/assets/js/55.ef80fe04.js"><link rel="prefetch" href="/blog/assets/js/56.b8269e5b.js"><link rel="prefetch" href="/blog/assets/js/57.903564fd.js"><link rel="prefetch" href="/blog/assets/js/7.57b0655a.js"><link rel="prefetch" href="/blog/assets/js/8.90da5599.js"><link rel="prefetch" href="/blog/assets/js/9.b5a43ae9.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.21b2360e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.bc4e2984.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="track-theme"><header class="theme-track--header"><div class="theme-track--navbar"><div class="theme-track--brand"><a href="/blog/" class="theme-track--logo router-link-active"><img src="/blog/images/logo.png"></a></div> <nav class="theme-track--nav-links"><ul><li><a href="/blog/" class="router-link-active">首页</a></li><li><a href="/blog/post/" class="router-link-active active">博客</a></li><li><a href="/blog/weekly/">周刊</a></li><li><a href="/blog/tag/">标签</a></li><li><a href="/blog/about.html">关于我们</a></li><li><a href="/blog/track.html">Track</a></li></ul> <div class="nav-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="theme-track--nav-mask" style="display:none;"></div></nav> <div class="theme-track--header-github"><a href="//github.com/kuaizi-co" target="_blank"><i class="iconfont icon-github"></i></a></div> <div class="theme-track--header-search"><div class="search-box"><i class="iconfont icon-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="search-text"></div> <ul class="search-suggestion" style="display:none;"></ul> <button class="search-btn"><i class="iconfont icon-search"></i></button></div></div></header> <div class="track-them--container"><div class="theme-track--content-wrapper"><img src="/blog/images/vue-cli-3-x.webp" class="theme-track--content-poster"> <div class="theme-track--content"><div class="sidebar-wrapper"><div><div class="sidebar"> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>vue-cli 3.x 升级之路</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/post/vue-cli-3-x-upgrade.html#导读" class="sidebar-link">导读</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/post/vue-cli-3-x-upgrade.html#vue-cli-基本要点" class="sidebar-link">vue-cli 基本要点</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/post/vue-cli-3-x-upgrade.html#如何将-vue-cli-2-x-项目升级到-3-x" class="sidebar-link">如何将 vue-cli 2.x 项目升级到 3.x</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/post/vue-cli-3-x-upgrade.html#kz-update-一键升级" class="sidebar-link">kz update 一键升级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/post/vue-cli-3-x-upgrade.html#期待" class="sidebar-link">期待</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div></div></div> <div class="theme-track--content-main"><p class="theme-track--content-date"><span>Publish: 2018-12-18 12:51:58</span> <span>
            Tags:
            <a href="/blog/tags/vue" class="tag">
              vue
            </a><a href="/blog/tags/vue-cli" class="tag">
              vue-cli
            </a></span></p> <div class="theme-track--content-meta"><h1>vue-cli 3.x 升级之路</h1> <div class="theme-track--github-card"><span><img src="https://github.com/tomieric.png?size=100"></span> <p class="theme-track--content-meta-author"><i class="iconfont icon-home"></i> tomieric</p> <!----></div> <!----></div> <div class="content__default"><h2 id="导读"><a href="#导读" class="header-anchor">#</a> 导读</h2> <ul><li><a href="https://cli.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue CLI 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s/49ahSgjypkELwGFXXUEMvw" target="_blank" rel="noopener noreferrer">如何使用Vue CLI 3加速你的开发工作流？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/miccycn/vue-cli-plugin-react" target="_blank" rel="noopener noreferrer">燃烧你的CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mp.weixin.qq.com/s/QhetPMLzlmZxaPdroxmDsw" target="_blank" rel="noopener noreferrer">我在维护VUE CLI项目过程中学到了什么@VueConf CN 2018<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="vue-cli-基本要点"><a href="#vue-cli-基本要点" class="header-anchor">#</a> vue-cli 基本要点</h2> <ul><li><a href="https://cli.vuejs.org/zh/guide/installation.html#%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer">安装<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cli.vuejs.org/zh/guide/prototyping.html#%E5%BF%AB%E9%80%9F%E5%8E%9F%E5%9E%8B%E5%BC%80%E5%8F%91" target="_blank" rel="noopener noreferrer">快速开发<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>demo：<a href="https://github.com/Kuaizi-co/kz-table/blob/dev/package.json#L8" target="_blank" rel="noopener noreferrer">kz-table<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://cli.vuejs.org/zh/guide/plugins-and-presets.html#%E8%BF%9C%E7%A8%8B-preset" target="_blank" rel="noopener noreferrer">安装、插件和 Preset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>demo： <a href="https://github.com/Kuaizi-co/vue-cli-preset-kz#vue-cli-preset-kz" target="_blank" rel="noopener noreferrer">vue-cli-preset-kz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener noreferrer">配置参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>demo：<a href="https://github.com/Kuaizi-co/vue-cli-preset-kz/blob/master/generator/templates/default/vue.config.js" target="_blank" rel="noopener noreferrer">vue.config.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" target="_blank" rel="noopener noreferrer">插件开发指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>demo1：<a href="https://github.com/Kuaizi-co/vue-cli-plugin-auto-router/blob/dev/index.js" target="_blank" rel="noopener noreferrer">vue-cli-plugin-auto-router<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>demo2：<a href="https://github.com/Kuaizi-co/vue-cli-plugin-register-component/blob/dev/index.js" target="_blank" rel="noopener noreferrer">vue-cli-plugin-register-component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>展望：<code>@kuaizi/vue-plugin-preset-kz</code></li></ul></li></ul> <h2 id="如何将-vue-cli-2-x-项目升级到-3-x"><a href="#如何将-vue-cli-2-x-项目升级到-3-x" class="header-anchor">#</a> 如何将 <code>vue-cli 2.x</code> 项目升级到 <code>3.x</code></h2> <h4 id="q-vue-cli-3-x-的项目依赖文件是什么"><a href="#q-vue-cli-3-x-的项目依赖文件是什么" class="header-anchor">#</a> Q: <code>vue-cli 3.x</code> 的项目依赖文件是什么？</h4> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/XIibZ0YbvibkX0ZtGgAqFEHn2Hq3icia76qRVrqBcGe2tgGHyzBQ5kU9vkGn0QY6MS2tQZBIodWE2IUjTggTMyRJ6g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="vue-cli 3项目目录"></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── README.md
├── babel.config.js √
├── node_modules
├── package.json √
├── public √
├── src √
├── tests
├── vue.config.js√
└── yarn.lock
</code></pre></div><p>其中主要的的文件主要有 <code>package.json</code> 和 <code>vue.config.js</code>，<code>babel.config.js</code> 是可选独立文件配置及 <code>package.json</code> 中配置。</p> <h4 id="q-如何升级已有项目的构建环境"><a href="#q-如何升级已有项目的构建环境" class="header-anchor">#</a> Q: 如何升级已有项目的构建环境？</h4> <h5 id="新建-vue-config-js-文件"><a href="#新建-vue-config-js-文件" class="header-anchor">#</a> 新建 <code>vue.config.js</code> 文件</h5> <p>在项目根目录新建 <code>vue.config.js</code>，该文件是 <code>vue-cli 3.x</code> 运行读取配置入口及 <code>vue ui</code> 获取项目并识别配置信息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">folder</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> folder<span class="token punctuation">)</span>
<span class="token comment">// 多页面入口路径</span>
<span class="token keyword">const</span> <span class="token constant">PAGE_PATH</span> <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/pages'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 获取多页面配置对象
 * @param {String} entry 是否指定单入口
 */</span>
<span class="token keyword">function</span> <span class="token function">getPagesConfig</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 规范中定义每个单页文件结构</span>
  <span class="token comment">// index.html,main.js,App.vue</span>
  glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span> <span class="token operator">+</span> <span class="token string">'/*/index.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">filePath</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> pageName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">&amp;&amp;</span> entry <span class="token operator">!==</span> pageName<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      pages<span class="token punctuation">[</span>pageName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        entry<span class="token operator">:</span> filePath<span class="token punctuation">,</span>
        <span class="token comment">// 除了首页，其他按第二级目录输出</span>
        <span class="token comment">// 浏览器中直接访问/news,省去/news.html</span>
        <span class="token comment">// 指定单页根目录直接访问</span>
        filename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName <span class="token operator">===</span> <span class="token string">'index'</span> <span class="token operator">||</span> entry <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> pageName <span class="token operator">+</span> <span class="token string">'/'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
        hash<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> pages
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取2.x 的配置</span>
  baseUrl<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> webpackConf<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsPublicPath <span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  assetsDir<span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
  <span class="token comment">// 禁用md5文件名，改查询参数 md5</span>
  filenameHashing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  productionSourceMap<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  lintOnSave<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  <span class="token comment">// 多页配置</span>
  pages<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>pages
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

   <span class="token comment">// 配置webpack</span>
   configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
    cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 定义你的环境变量</span>
        <span class="token constant">VUE_APP_ALLOW_ROUTES</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>argv<span class="token punctuation">.</span>route<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token punctuation">{</span>
      hints<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// vue cli 3.x默认没有生产manifest.js文件</span>
      runtimeChunk<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'manifest'</span> <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 扩展webpack配置</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 移除 prefetch 插件</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'preload'</span><span class="token punctuation">)</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'prefetch'</span><span class="token punctuation">)</span>
    <span class="token comment">// 移除多页面preload,prefetch插件</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">page</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">preload-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prefetch-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    config<span class="token punctuation">.</span>resolve
      <span class="token punctuation">.</span>alias
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'vue$'</span><span class="token punctuation">,</span> <span class="token string">'vue/dist/vue.esm.js'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'assets'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/assets'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/config'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'components'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/entries/index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'I18n'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/i18n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Lib'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/lib'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'API'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/lib/services'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'mixins'</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/lib/mixins'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 自动别名</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>devRouter<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">alias</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>alias<span class="token punctuation">,</span> devRouter<span class="token punctuation">[</span>alias<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 添加 css 全局变量资源插件</span>
    <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'vue-modules'</span><span class="token punctuation">,</span> <span class="token string">'vue'</span><span class="token punctuation">,</span> <span class="token string">'normal-modules'</span><span class="token punctuation">,</span> <span class="token string">'normal'</span><span class="token punctuation">]</span>
    types<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
      <span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token function">addStyleResource</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 开发服务器配置</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// port: `8081`,</span>
    port<span class="token operator">:</span> webpackConf<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> webpackConf<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>proxyTable
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置这么少就可以升级到 <code>vue-cli 3.x</code> 环境吗？当然还缺少 <code>vue cli 3.x</code> 构建运行的依赖包，我们要修改 <code>package.json</code>，移除一些旧的依赖如 <code>babel-loader</code>、<code>webpack</code>等等一些，重新安装新的版本，新的版本大多数新的依赖包会指定 <code>@scope</code>，比如 <code>@babel/core@7.0.0-beta.47</code>, <code>&quot;@vue/cli-plugin-babel&quot;</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preset-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;private&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service build&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service lint&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 兼容旧的命令</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service serve --copy&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;review&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serve -s dist&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;test:e2e&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service test:e2e&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;test:unit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service test:unit&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.18.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;babel-polyfill&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.22.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;countup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.8.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;echarts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.0-rc.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;iview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.1.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.11&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;normalize.css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;nprogress&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.5.17&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vue-i18n&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vue-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vuex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建环境依赖的包</span>
    <span class="token string">&quot;@vue/cli-plugin-babel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/cli-plugin-e2e-nightwatch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/cli-plugin-eslint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/cli-plugin-unit-mocha&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/cli-service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0-beta.20&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;chai&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.1.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;less&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.7.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;less-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^10.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style-resources-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;vue-template-compiler&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.5.17&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;eslintConfig&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;root&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;node&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;plugin:vue/essential&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;eslint:recommended&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;vue/no-parsing-error&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;x-invalid-end-tag&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;parserOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;postcss&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;autoprefixer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;not ie &lt;= 8&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="q-貌似还是挺麻烦的-有没有更快的方式"><a href="#q-貌似还是挺麻烦的-有没有更快的方式" class="header-anchor">#</a> Q：貌似还是挺麻烦的，有没有更快的方式？</h4> <p>有的，通过自行写脚本命令去处理。</p> <p><strong>目标：</strong></p> <ul><li>移除旧的配置文件，如<code>.babelrc</code>、<code>.eslintrc</code>等</li> <li>替换依赖包新的版本和添加新依赖，如 <code>@vue/cli-plugin-babel</code>、<code>babel-loader@8.04</code>等</li> <li>新建文件<code>babel.config.js</code>、<code>.env.local</code>等</li></ul> <div class="vuepress-flowchart loading"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 30 30" class="vuepress-flowchart-loading-icon" style="enable-background:new 0 0 50 50;"><rect x="0" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0s" dur="0.6s" repeatCount="indefinite"></animate></rect> <rect x="10" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate></rect> <rect x="20" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate></rect></svg></div><h5 id="_1-移除旧的配置文件"><a href="#_1-移除旧的配置文件" class="header-anchor">#</a> 1.移除旧的配置文件</h5> <p>移除旧的文件会容易造成旧的配置文件丢失，因此我们的做法就是将旧的配置文件重命名即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> renameFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.babelrc'</span><span class="token punctuation">,</span> <span class="token string">'.eslintrc.js'</span><span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">]</span>
<span class="token comment">// rename old file</span>
renameFiles<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token function">resolveFile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span><span class="token function">resolveFile</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>f<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h5 id="_2-替换依赖包新的版本和添加新依赖"><a href="#_2-替换依赖包新的版本和添加新依赖" class="header-anchor">#</a> 2. 替换依赖包新的版本和添加新依赖</h5> <p>我们将 <code>vue-cli 3.x</code> 生成的项目下的 <code>package.json</code> 作为配置文件模板，将新旧文件json合并到新的配置文件 <code>package.json</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> removeDependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'vue-template-compiler'</span><span class="token punctuation">,</span> <span class="token string">'babel-core'</span><span class="token punctuation">,</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span> <span class="token string">'vue-style-loader'</span><span class="token punctuation">,</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">,</span> <span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">,</span> <span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">,</span> <span class="token string">'webpack-hot-middleware'</span><span class="token punctuation">,</span> <span class="token string">'html-webpack-plugin'</span><span class="token punctuation">,</span> <span class="token string">'babel-plugin-transform-runtime'</span><span class="token punctuation">,</span> <span class="token string">'babel-polyfill'</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> updatePkg <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readJSONSync</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./template/package.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Remove old Dependencies</span>
removeDependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies <span class="token operator">&amp;&amp;</span> pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>devDependencies <span class="token operator">&amp;&amp;</span> pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> pkg<span class="token punctuation">.</span>devDependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// update package.json</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
  <span class="token string">'./package.json'</span><span class="token punctuation">,</span> 
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
    <span class="token function">merge</span><span class="token punctuation">(</span>
      pkg<span class="token punctuation">,</span>
      updatePkg<span class="token punctuation">,</span>
      <span class="token comment">// 旧项目名称版本保留</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        version<span class="token operator">:</span> pkg<span class="token punctuation">.</span>version<span class="token punctuation">,</span>
        author<span class="token operator">:</span> pkg<span class="token punctuation">.</span>author
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><h5 id="新建文件"><a href="#新建文件" class="header-anchor">#</a> 新建文件</h5> <p>新的配置文件我们可以从模板目录中考到就项目目录中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> copyFiles <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'.editorconfig'</span><span class="token punctuation">,</span> 
  <span class="token string">'.eslintignore'</span><span class="token punctuation">,</span> 
  <span class="token string">'babel.config.js'</span><span class="token punctuation">,</span> 
  <span class="token string">'vue.config.js'</span><span class="token punctuation">,</span> 
  <span class="token string">'.env.local'</span><span class="token punctuation">,</span> 
  <span class="token string">'styleguide.config.js'</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./template/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> file
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// fs.copyFileSync</span>
copyFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">copySync</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token function">resolveFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="kz-update-一键升级"><a href="#kz-update-一键升级" class="header-anchor">#</a> kz update 一键升级</h2> <p><code>vue cli 2.x</code> 项目一键升级 <code>vue-cli 3.x</code> 童叟无欺。只需</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> kz update
</code></pre></div><div class="vuepress-flowchart loading"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 30 30" class="vuepress-flowchart-loading-icon" style="enable-background:new 0 0 50 50;"><rect x="0" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0s" dur="0.6s" repeatCount="indefinite"></animate></rect> <rect x="10" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate></rect> <rect x="20" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate> <animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate></rect></svg></div><ul><li><a href="https://kuaizi-co.github.io/kz-cli/command/update.html" target="_blank" rel="noopener noreferrer">详细文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="期待"><a href="#期待" class="header-anchor">#</a> 期待</h2> <p><code>vue cli 3.x</code> 插件社区将越来越完善，丰富好用的插件会越来越多，将优秀的插件组合不断的优化我们的构建工作流，同时我们也可以尝试开发自己合适的插件，不断的提高自己。</p></div> <p class="theme-track--content-page"><a href="/blog/post/developer-roadmap.html" class="prev"><i class="iconfont icon-prev"></i>
            前端的开发之路指南 developer-roadmap
          </a> <a href="/blog/post/vue-cli-plugin-register-component.html" class="next">
            vue 组件自动注册插件
            <i class="iconfont icon-next"></i></a></p> <div id="comment-container"></div></div></div></div></div> <div class="theme-track--footer"><p>MIT Licensed | Copyright © 2018-present <a href="//www.kuaizi.ai" target="_blank">www.kuaizi.ai</a>, <a href="https://kuaizi-co.github.io/blog/rss.xml" target="_blank">订阅周刊</a></p> <p>
  Powered by vuepress theme <a href="//github.com/tomieric/vuepress-theme-track" target="_blank">Track</a>.
  Inspired by <a href="//github.com/Yubisaki/vuepress-theme-yubisaki" target="_blank">yubisaki</a></p></div></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.d3fa5209.js" defer></script><script src="/blog/assets/js/6.d4095322.js" defer></script><script src="/blog/assets/js/4.64cbf7a8.js" defer></script><script src="/blog/assets/js/28.a5fc788a.js" defer></script><script src="/blog/assets/js/10.ce23e8e8.js" defer></script><script src="/blog/assets/js/11.7cde289b.js" defer></script><script src="/blog/assets/js/30.967a757e.js" defer></script><script src="/blog/assets/js/25.3294d02e.js" defer></script><script src="/blog/assets/js/13.4b26077c.js" defer></script><script src="/blog/assets/js/21.65ff6ff5.js" defer></script><script src="/blog/assets/js/31.6775aed3.js" defer></script><script src="/blog/assets/js/23.c6a37407.js" defer></script><script src="/blog/assets/js/15.b4502122.js" defer></script><script src="/blog/assets/js/5.865b38fd.js" defer></script><script src="/blog/assets/js/49.53cd3ec8.js" defer></script><script src="/blog/assets/js/24.193852d3.js" defer></script>
  </body>
</html>
